<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Online IDE - VS Code Style</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; background: #1e1e1e; font-family: "Segoe UI", sans-serif; color: #ccc; }

    .container { display: flex; height: 100vh; }
    .sidebar { width: 150px; background: #252526; display: flex; flex-direction: column; padding: 10px; }
    .sidebar button {
      background: none; border: none; color: #ccc; padding: 10px; text-align: left; cursor: pointer; border-radius: 4px;
    }
    .sidebar button.active { background: #3c3c3c; }

    .editor-section { flex: 1; display: flex; flex-direction: column; background: #1e1e1e; }
    .tabs { display: flex; background: #2d2d2d; }
    .tabs button {
      background: none; border: none; color: #ccc; padding: 10px 15px; cursor: pointer; border-bottom: 2px solid transparent;
    }
    .tabs button.active { border-bottom: 2px solid #007acc; background: #1e1e1e; }

    .editor { flex: 1; }
    .preview { flex: 1; border: none; }

    .right-pane { display: flex; flex-direction: column; flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <button onclick="openFile('index.html')" id="btn-index.html">index.html</button>
      <button onclick="openFile('style.css')" id="btn-style.css">style.css</button>
      <button onclick="openFile('script.js')" id="btn-script.js">script.js</button>
    </div>

    <div class="editor-section">
      <div class="tabs" id="tabs"></div>
      <div id="editor" class="editor"></div>
    </div>

    <div class="right-pane">
      <iframe id="preview" class="preview"></iframe>
    </div>
  </div>

  <!-- Monaco CDN -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/loader.js"></script>

  <script>
    // Setup Monaco loader
    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs' } });

    const files = {
      "index.html": { content: "<!DOCTYPE html>\n<html>\n<head>\n  <title>Live Preview</title>\n</head>\n<body>\n  <h1>Hello World</h1>\n  <p>Edit files to see live preview!</p>\n</body>\n</html>", language: "html" },
      "style.css": { content: "body { background: #f0f0f0; color: #333; font-family: Arial; } h1 { color: steelblue; }", language: "css" },
      "script.js": { content: "document.querySelector('h1').addEventListener('click', () => alert('Hello from JS!'))", language: "javascript" }
    };

    let editor, currentFile = "index.html";

    require(['vs/editor/editor.main'], function () {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: files[currentFile].content,
        language: files[currentFile].language,
        theme: 'vs-dark',
        automaticLayout: true,
      });

      openFile('index.html');

      editor.onDidChangeModelContent(() => {
        files[currentFile].content = editor.getValue();
        renderPreview();
      });
    });

    function openFile(name) {
      currentFile = name;
      editor.setValue(files[name].content);
      monaco.editor.setModelLanguage(editor.getModel(), files[name].language);
      updateTabs();
      renderPreview();
    }

    function updateTabs() {
      document.getElementById('tabs').innerHTML = '';
      Object.keys(files).forEach(name => {
        const btn = document.createElement('button');
        btn.textContent = name;
        btn.className = currentFile === name ? 'active' : '';
        btn.onclick = () => openFile(name);
        document.getElementById('tabs').appendChild(btn);
      });

      // Highlight sidebar
      document.querySelectorAll('.sidebar button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.id === 'btn-' + currentFile) btn.classList.add('active');
      });
    }

    function renderPreview() {
      let htmlContent = files['index.html'].content;
      let css = files['style.css'].content;
      let js = files['script.js'].content;

      const hasHead = htmlContent.includes("</head>");
      const injection = `
        <style>${css}</style>
        <script>${js}<\/script>
      `;

      if (hasHead) {
        htmlContent = htmlContent.replace("</head>", `${injection}</head>`);
      } else if (htmlContent.includes("</body>")) {
        htmlContent = htmlContent.replace("</body>", `${injection}</body>`);
      } else {
        htmlContent += injection;
      }

      document.getElementById('preview').srcdoc = htmlContent;
    }
  </script>
</body>
</html>
